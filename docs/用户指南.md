# GemRelic 用户指南

![Minecraft](https://img.shields.io/badge/Minecraft-1.20.x-green)
![Paper](https://img.shields.io/badge/Paper-1.20.x-blue)
![Java](https://img.shields.io/badge/Java-17-orange)

## 📖 目录

- [插件介绍](#插件介绍)
- [安装指南](#安装指南)
- [快速开始](#快速开始)
- [圣遗物系统](#圣遗物系统)
- [GUI界面使用](#GUI界面使用)
- [命令使用](#命令使用)
- [权限配置](#权限配置)
- [配置说明](#配置说明)
- [AttributePlus集成](#AttributePlus集成)
- [常见问题](#常见问题)

---

## 🎮 插件介绍

**GemRelic** 是一个为 Minecraft Paper 1.20.x 服务器设计的圣遗物属性系统插件，高度还原《原神》圣遗物核心玩法。

### 主要特性

✅ **圣遗物5部位系统**
- 生之花 (FLOWER) / 死之羽 (PLUME) / 时之沙 (SANDS) / 空之杯 (GOBLET) / 理之冠 (CIRCLET)
- 主词条与副词条系统
- 1-5星稀有度等级
- 完整的属性类型支持（攻击、暴击、攻速、移速等）

✅ **套装效果系统**
- 2件套装效果自动激活
- 4件套装效果自动激活  
- 实时属性修饰应用
- 套装件数统计显示

✅ **完整GUI系统**
- 主菜单导航界面
- 装备管理页面（查看已装备，支持卸下）
- 仓库管理页面（分页筛选，支持装备/取出）
- 直观的操作提示与反馈

✅ **数据管理系统**
- 圣遗物↔ItemStack双向转换
- 玩家档案YAML持久化
- 仓库与背包互通操作

✅ **扩展兼容性**
- AttributePlus插件软依赖支持
- 配置化属性映射
- 热重载支持

---

## 🔧 安装指南

### 系统要求

- **服务器核心**: Paper 1.20.x 或更高版本
- **Java版本**: Java 17 或更高版本
- **服务器RAM**: 建议至少 2GB

### 安装步骤

1. **下载插件**
   ```
   从 Releases 页面下载 gemrelic-1.0.0.jar
   ```

2. **部署插件**
   ```
   将 jar 文件放入服务器的 plugins/ 目录
   ```

3. **启动服务器**
   ```
   重启服务器或使用插件管理器加载
   ```

4. **验证安装**
   ```
   在控制台或游戏中输入 /gemrelic help
   如果显示帮助信息，说明安装成功
   ```

### 自动生成的文件

安装成功后，插件会在 `plugins/GemRelic/` 目录下生成：

```
plugins/GemRelic/
├── config.yml        # 主配置文件
└── gems.yml          # 宝石定义文件
```

---

## 🚀 快速开始

### 第一步：熟悉命令

所有命令都以 `/relic` 开头，输入后按 **Tab** 键可以自动补全：

```bash
/relic help         # 查看帮助
/relic list         # 查看可用套装类型
/relic open         # 打开圣遗物系统主菜单
```

### 第二步：获得测试圣遗物

```bash
# 添加测试圣遗物到仓库（包含5个部位各1件）
/relic test
```

### 第三步：打开圣遗物界面

```bash
# 打开圣遗物系统主菜单
/relic open
```

你会看到主菜单界面，可以选择装备管理或仓库管理！

### 第四步：体验圣遗物功能

1. **仓库管理** - 查看刚才添加的测试圣遗物
2. **左键装备** - 将圣遗物装备到对应部位  
3. **装备管理** - 查看已装备圣遗物和套装效果
4. **右键取出** - 将圣遗物取出到背包
5. **放入仓库** - 使用放入按钮收集背包圣遗物

---

## ⌨️ 命令使用

### 命令格式

所有命令都使用 `/relic` 作为主命令，支持以下子命令：

| 命令 | 用法 | 说明 | 权限 |
|------|------|------|------|
| `open` | `/relic open` | 打开圣遗物系统主菜单 | `gemrelic.user` |
| `list` | `/relic list` | 列出所有配置的套装 | `gemrelic.user` |
| `test` | `/relic test` | 添加测试圣遗物到仓库 | `gemrelic.user` |
| `reload` | `/relic reload` | 重载插件配置 | `gemrelic.admin` |
| `equip` | `/relic equip <slot> <setId>` | 直接装备测试圣遗物 | `gemrelic.user` |
| `unequip` | `/relic unequip <slot>` | 直接卸下圣遗物 | `gemrelic.user` |

### 详细说明

#### 1. 打开系统 (`open`)

**语法**：`/relic open`

**功能**：打开圣遗物系统主菜单，提供以下选项：
- **装备管理** - 查看当前穿戴的圣遗物
- **仓库管理** - 管理仓库中的圣遗物

**使用流程**：
1. 输入命令打开主菜单
2. 选择要进入的功能页面
3. 在各页面间自由导航

#### 2. 列出套装 (`list`)

**语法**：`/relic list`

显示服务器上所有已配置的套装类型，包括：
- gladiator (角斗士的终幕礼)
- 其他在 `relics/sets.yml` 中配置的套装

#### 3. 添加测试物品 (`test`)

**语法**：`/relic test`

**功能**：
- 为当前玩家生成5件测试圣遗物（每个部位1件）
- 所有测试物品都是5星金装，等级20，带有完整副词条
- 主要用于功能测试和演示

#### 4. 重载配置 (`reload`)

**语法**：`/relic reload`

**功能**：
- 重新加载 config.yml 配置
- 重新加载 relics/sets.yml 套装定义
- 刷新所有缓存数据

**注意**：需要管理员权限

#### 5. 测试装备命令 (`equip`/`unequip`)

**语法**：
- `/relic equip <slot> <setId>` - 直接装备指定套装到指定部位
- `/relic unequip <slot>` - 直接卸下指定部位的圣遗物

**参数说明**：
- `<slot>`: 部位名称（FLOWER/PLUME/SANDS/GOBLET/CIRCLET）
- `<setId>`: 套装ID（如 gladiator）

**示例**：
```bash
# 装备角斗士生之花
/relic equip FLOWER gladiator

# 卸下生之花部位
/relic unequip FLOWER
```

**注意**：这是测试命令，正常游戏建议使用GUI界面操作

---

## 💎 圣遗物系统

### 5部位系统

圣遗物共有5个固定部位，每个部位只能装备一件：

| 部位 | 中文名 | 主词条特点 | 说明 |
|------|--------|------------|------|  
| FLOWER | 生之花 | 固定生命值 | 提供固定的生命值加成 |
| PLUME | 死之羽 | 固定攻击力 | 提供固定的攻击力加成 |
| SANDS | 时之沙 | 可变 | 攻击%、生命%、防御%、攻速等 |
| GOBLET | 空之杯 | 可变 | 各种伤害加成、攻击%等 |
| CIRCLET | 理之冠 | 可变 | 暴击率、暴击伤害、治疗加成等 |

### 稀有度系统  

圣遗物分为5个稀有度等级：

| 稀有度 | 星级 | 颜色 | 等级上限 | 材质显示 |
|--------|------|------|----------|----------|
| WHITE | 1★ | §f白色 | 10级 | 石英 |
| GREEN | 2★ | §a绿色 | 15级 | 绿宝石 |
| BLUE | 3★ | §9蓝色 | 20级 | 青金石 |
| PURPLE | 4★ | §d紫色 | 25级 | 紫水晶碎片 |
| GOLD | 5★ | §6金色 | 30级 | 金锭 |

### 套装效果

收集同套装的圣遗物可以激活套装效果：
- **2件套装** - 激活基础效果
- **4件套装** - 激活强化效果

当前可用套装：
- **角斗士的终幕礼** - 2件套+18%攻击力，4件套近战伤害+35%

---

## 🖱️ GUI界面使用

### 主菜单界面

进入方式：`/relic open`

**界面布局**：
```
┌─────────────────────────────┐
│    §6§l圣遗物系统            │
│                             │
│   🛡️ 装备管理   📦 仓库管理   │  
│                             │
└─────────────────────────────┘
```

**操作说明**：
- **装备管理** - 进入装备页面
- **仓库管理** - 进入仓库页面

### 装备管理界面

**界面功能**：
- 显示当前穿戴的5件圣遗物
- 套装加成统计显示
- 支持卸下操作

**操作说明**：
- **点击已装备圣遗物** → 卸下到仓库
- **空槽位提示** → 提醒前往仓库选择
- **返回按钮** → 回到主菜单

### 仓库管理界面

**界面功能**：
- 分页显示仓库中的圣遗物
- 部位筛选功能
- 支持装备、取出、放入操作

**操作说明**：
- **左键圣遗物** → 装备到对应部位
- **右键圣遗物** → 取出到背包  
- **筛选按钮** → 循环切换部位筛选（全部→花→羽→沙→杯→冠）
- **翻页按钮** → 上一页/下一页
- **放入按钮** → 将背包中所有圣遗物物品放入仓库
- **返回按钮** → 回到主菜单

---

## 🔐 权限配置

### 权限节点表

| 权限节点 | 默认值 | 说明 |
|----------|---------|------|
| `gemrelic.user` | true | 使用 /relic 基础命令 |
| `gemrelic.admin` | OP | 管理员权限（重载配置等） |

### 权限配置示例

#### 使用 LuckPerms

```bash
# 给予玩家基础使用权限
/lp user <玩家名> permission set gemrelic.user true

# 给予管理员完整权限
/lp user <管理员> permission set gemrelic.admin true

# 给予组权限
/lp group default permission set gemrelic.user true
```

#### 使用 PermissionsEx

```yaml
groups:
  default:
    permissions:
      - gemrelic.user
  admin:
    permissions:
      - gemrelic.admin
```

---

## ⚙️ 配置说明

### config.yml 配置详解

```yaml
# 插件基本设置
settings:
  debug: false                    # 调试模式
  language: zh_CN                 # 语言设置

# 圣遗物系统设置
relic:
  enabled: true                   # 是否启用圣遗物系统
  calculation_mode: additive      # 属性计算模式：加法/乘法
  warehouse_max_size: 1000        # 仓库最大容量

# 消息配置
messages:
  prefix: "§6[GemRelic]§r "       # 消息前缀
  no_permission: "§c你没有权限执行此操作！"
  reload_success: "§a配置重载成功！"

# AttributePlus集成配置
integration:
  attributeplus:
    enabled: true                 # 是否启用AP集成
    namespace: GemRelic           # 修饰器命名空间
    stat_map:                     # 圣遗物属性 → AP属性映射
      CRIT_RATE: crit_chance      # 暴击率 → AP暴击概率
      CRIT_DMG: crit_damage       # 暴击伤害 → AP暴击伤害
      ATK_SPEED: attack_speed     # 攻击速度 → AP攻击速度
      MOVE_SPEED: move_speed      # 移动速度 → AP移动速度
      LUCK: luck                  # 幸运 → AP幸运
      KB_RES: knockback_resistance # 击退抗性 → AP击退抗性
    operation:
      default: add                # 默认操作类型
```

### relics/sets.yml 配置详解

```yaml
sets:
  gladiator:                      # 套装ID
    id: gladiator                 # 内部标识符
    name: "角斗士的终幕礼"         # 套装显示名称
    bonuses:                      # 套装效果配置
      two_piece_desc:             # 2件套装效果描述
        - "攻击力+18%"
      four_piece_desc:            # 4件套装效果描述
        - "持剑/双手剑/长柄武器时，普通攻击造成的伤害提升35%"
        
  # 可以添加更多套装...
  wanderer:
    id: wanderer
    name: "流浪大地的乐团"
    bonuses:
      two_piece_desc:
        - "精通+80"
      four_piece_desc:
        - "装备弓箭或法器的角色，重击造成的伤害提升35%"
```

---

## 📝 使用示例

### 场景1：新玩家快速上手

```bash
# 1. 管理员为新玩家添加测试圣遗物
/relic test

# 2. 玩家打开圣遗物系统
/relic open

# 3. 进入仓库管理，装备圣遗物体验套装效果
```

### 场景2：圣遗物管理操作

#### 通过GUI操作（推荐）
1. `/relic open` 打开主菜单
2. 选择"仓库管理"
3. **左键**圣遗物装备到部位
4. 选择"装备管理"查看套装效果
5. **点击**已装备圣遗物卸下到仓库
6. **右键**仓库圣遗物取出到背包
7. 使用**放入按钮**收集背包圣遗物

#### 通过命令操作（测试用）
```bash  
# 直接装备角斗士生之花
/relic equip FLOWER gladiator

# 卸下生之花部位
/relic unequip FLOWER

# 查看套装效果（控制台日志）
```

### 场景3：管理员管理服务器

```bash
# 查看所有已配置的套装
/relic list

# 重载配置（修改配置文件后）
/relic reload
```

### 场景4：套装效果验证

装备2件角斗士套装后，在控制台可以看到：
```
[INFO] [Relic] PlayerName 套装统计: {gladiator=2}, 词条合计={ATK_PCT=93.2, CRIT_RATE=15.6}
```

表明套装效果已生效！

---

## 🔌 AttributePlus集成

### 什么是AttributePlus集成

GemRelic支持与AttributePlus插件的深度集成，可以将圣遗物的扩展属性（如暴击率、攻击速度等）同步到AttributePlus系统。

### 启用AP集成

#### 前提条件
1. 服务器安装了AttributePlus插件
2. 在 `config.yml` 中启用集成：
```yaml
integration:
  attributeplus:
    enabled: true
```

#### 属性映射

圣遗物系统会将以下属性同步到AttributePlus：

| 圣遗物属性 | AttributePlus属性 | 说明 |
|-----------|------------------|------|
| CRIT_RATE | crit_chance | 暴击率 |
| CRIT_DMG | crit_damage | 暴击伤害 |
| ATK_SPEED | attack_speed | 攻击速度 |
| MOVE_SPEED | move_speed | 移动速度 |
| LUCK | luck | 幸运值 |
| KB_RES | knockback_resistance | 击退抗性 |

#### 工作原理

1. **装备圣遗物** → 聚合属性 → 同步到AP系统
2. **卸下圣遗物** → 清理对应的AP修饰器
3. **玩家退出** → 自动清理所有GemRelic来源的AP修饰

#### 配置自定义映射

可以在 `config.yml` 中自定义属性映射：

```yaml
integration:
  attributeplus:
    stat_map:
      CRIT_RATE: "你的AP暴击属性名"
      ATK_SPEED: "你的AP攻速属性名"
    operation:
      CRIT_RATE: add      # 加法操作
      ATK_SPEED: percent  # 百分比操作
```

### 故障排除

#### AP集成不生效？
1. 检查AttributePlus插件是否正确安装
2. 检查 `config.yml` 中 `integration.attributeplus.enabled` 是否为 `true`
3. 检查服务器日志中是否有AP相关错误信息
4. 使用 `/relic reload` 重载配置

#### 属性值异常？
1. 检查 `stat_map` 中的属性名是否与你的AP配置匹配
2. 确认 `operation` 配置是否正确（add/percent/multiply）

---

## ❓ 常见问题

### Q: 圣遗物系统与原版属性冲突吗？
A: 不冲突。圣遗物系统使用Minecraft原生的AttributeModifier系统，并通过命名空间隔离确保安全清理。

### Q: 可以同时装备多个相同部位的圣遗物吗？
A: 不可以。每个部位只能装备一件圣遗物，这是原神圣遗物系统的核心设计。

### Q: 圣遗物物品可以交易吗？
A: 可以。圣遗物使用ItemStack形式存在，支持掉落、交易、箱子存储等所有原版物品操作。

### Q: 套装效果什么时候生效？
A: 套装效果在穿戴/卸下圣遗物时实时计算并应用，无需重新登录。

### Q: 如何备份圣遗物数据？
A: 圣遗物数据存储在 `plugins/GemRelic/players/` 目录下的YAML文件中，定期备份该目录即可。

### Q: 服务器升级后数据会丢失吗？
A: 不会。圣遗物数据使用PersistentDataContainer和YAML双重存储，具有良好的版本兼容性。

## 🔗 相关链接

- [项目主页](../../)
- [问题反馈](../../issues)
- [功能建议](../../discussions)
- [开发文档](PROJECT_STRUCTURE.md)

---

## 📞 技术支持

如果你在使用过程中遇到问题，可以通过以下方式获得帮助：

1. **查看日志** - 检查 `logs/latest.log` 中的错误信息
2. **提交 Issue** - 在 GitHub 上报告问题
3. **社区讨论** - 在 Discussions 中与其他用户交流

---

## 🎯 开发路线图

### 即将推出的功能

🔜 **随机生成系统**
- 配置驱动的主副词条权重
- 多源掉落配置（怪物、箱子、副本）
- `/relic roll` 随机生成命令

🔜 **强化系统**
- 经验曲线升级机制
- +5级跳副词条
- 圣遗物分解与精粹回收

🔜 **高级功能**
- 圣遗物锁定保护
- 套装图鉴与收集进度
- 副词条重掷与洗练系统

### 技术规划

🔧 **性能优化**
- 属性缓存与节流刷新
- 异步数据保存
- GUI交互优化

🔧 **系统完善**
- Effect DSL解析引擎
- 更丰富的套装类型
- 平衡性调优工具

---

> 感谢使用 GemRelic 圣遗物系统！如果这个插件对你有帮助，请考虑给项目点个 ⭐ Star！
